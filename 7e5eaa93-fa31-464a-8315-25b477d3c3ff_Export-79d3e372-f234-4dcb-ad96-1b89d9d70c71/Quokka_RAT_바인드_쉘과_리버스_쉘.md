# Quokka RAT : 바인드 쉘과 리버스 쉘

<aside>
⚠️

author : 전재호(agamtt) 2024-03-17

</aside>

<aside>
💡 **사전지식필요
[소켓, 포트, IP, 인바운드, 아웃바운드, 방화벽, 포트포워딩](%E1%84%89%E1%85%A9%E1%84%8F%E1%85%A6%E1%86%BA,%20%E1%84%91%E1%85%A9%E1%84%90%E1%85%B3,%20IP,%20%E1%84%8B%E1%85%B5%E1%86%AB%E1%84%87%E1%85%A1%E1%84%8B%E1%85%AE%E1%86%AB%E1%84%83%E1%85%B3,%20%E1%84%8B%E1%85%A1%E1%84%8B%E1%85%AE%E1%86%BA%E1%84%87%E1%85%A1%E1%84%8B%E1%85%AE%E1%86%AB%E1%84%83%E1%85%B3,%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%92%E1%85%AA%E1%84%87%E1%85%A7%202a056421d2234dd9aaf23db548b99102.md) 
[docker container 에 ssh 접속하기](docker%20container%20%E1%84%8B%E1%85%A6%20ssh%20%E1%84%8C%E1%85%A5%E1%86%B8%E1%84%89%E1%85%A9%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%20a33825b9572040b0862e388708bb4ded.md)**

[Socket / IP / Port / network](Socket%20IP%20Port%20network%20e18b03543f5e46999042b2a19b383d55.md)

위 문서를 숙지해야 이해할 수 있습니다.

</aside>

# 원격 쉘 (remote shell)

외부에서 컴퓨터를 원격으로 컨트롤하기 위해, 네트워크를 통해 원격으로 쉘을 사용할 수 있게 해주는 것을 **원격 쉘(remote shell)** 이라고 부릅니다.

Hackademy 의 컴퓨터 네트워크에서 배운 ssh 가 대표적인 원격 쉘 입니다.

# 바인드 쉘과 리버스 쉘

원격쉘은 **바인드쉘(bind shell)** 과 **리버스쉘(reverse shell)** 로 나뉩니다.

**바인드 쉘**은, 쉘 커맨드가 실행되는 컴퓨터에서 포트를 열고, 외부에서 터미널로 접속하는 방식의 원격 쉘을 말합니다.

openssh-server 는 **바인드 쉘**입니다. 원격으로 접속하려면, 쉘 커맨드가 실행되는 컴퓨터의 **IP주소**와, 열려있는 ssh 포트번호를 알아야하며, 해당 포트가 열려있어야 했습니다.

따라서 ssh 연결을 하기 위해 우리는 IP와 포트 두가지를 설정했습니다.

- 컨테이너에서 컨테이너로 ssh 접속할 때, ipconfig 로 IP 주소를 알아야 했습니다.
- 호스트(도커를 설치한 컴퓨터)에서 컨테이너로 접속할 때 IP 는 [localhost](http://localhost) 입니다.
- sshd_config 파일을 편집해서 Port 번호를 설정하고, service ssh 를 껐다 켜서 해당 포트를 적용했습니다.

**즉, 컴퓨터 네트워크를 통해 어떤 컴퓨터에 연결하려면 IP주소와 포트번호를 알아야하며, 연결이 허용되어있어야 합니다.**

# 리버스 쉘

**리버스 쉘**은, 쉘 커맨드가 실행되는 컴퓨터에서 외부에 어떤 IP 와 포트번호를 알고 있는, 포트가 열린 컴퓨터에 거꾸로 요청을 보내고, 그 연결에 쉘을 연결하는 형태를 말합니다.

해커가 어떤 컴퓨터로 침입할 때, **두가지 제약조건이 생깁니다.**

- 공격할 컴퓨터의 IP 주소를 모른다.
- 공격할 컴퓨터의 포트가 열려있지 않다.

리버스 쉘은 이를 극복하기 위한 방법입니다.

우선, 해커는 다양한 방법을 통해서 리버스 쉘을 피해자의 컴퓨터에서 실행시킵니다.

(피싱메일을 클릭하게 하기, 무료버전의 프로그램을 다운받아 클릭하게 하기, 임의코드실행 취약점을 악용하기, 방법은 매우 다양합니다.)

그 리버스쉘에는 해커가 공격에 쓸 서버의 IP 주소와 포트번호가 입력되어있습니다.

해커는 해당 IP주소와 포트번호를 가진 서버를 열어놓고, 리버스쉘이 연결되기를 기다립니다. 이것을 리슨(listen)이라고 하고, 그런 프로그램을 listener 라고 부릅니다.

리버스쉘이 연결되면, 이 해커의 서버를 통해 명령을 내립니다. 이 서버가 바로 C2 서버입니다.

# 리버스 쉘 방지

리버스 쉘이 설치되면, 외부에서 누군가가 컴퓨터의 파일을 엿보고, 스크린샷을 찍고, 키보드로 무엇을 입력하는지 도청하고, 컴퓨터를 원격 조종할 수 있습니다.

보통 그런 짓을 하는 이유는 컴퓨터의 파일을 잠궈서 협박하거나(랜섬웨어), 금융정보를 훔치기 위함입니다.

리버스쉘은 매우 치명적인 악성코드로, 컴퓨터에 설치되면 매우 위험합니다.

따라서, 알약이나 V3 같은 실시간 보안 프로그램은 컴퓨터의 포트를 살피면서, 리버스쉘 연결이 없는지 검사합니다.

![Untitled](Untitled%20584.png)

![Untitled](Untitled%20585.png)

그리고 해커는 이 감시에 탐지되지 않기 위하여 리버스쉘을 알아보기 어렵게, 정상적인 프로그램으로 위장합니다. 이것을 **난독화**(Obfuscation) 라고 부릅니다.

난독화한 코드를 악성코드로 탐지해내고, 그것을 더 난독화해서 숨기고, 이러한 창과 방패의 대결은 아직도 현재 진행중입니다.

(우리는 난독화에 대해서는 어려우니 Hackademy 에서는 다루지 않고, Project 에서 다루도록 하겠습니다. 즉, 우리의 악성코드는 백신에 탐지 당합니다.)

참고

[난독화와 코드 가상화 - 악성코드에 사용되는 바이너리 보호기법](https://www.igloo.co.kr/security-information/난독화와-코드-가상화-악성코드에-사용되는-바이너/)

계속