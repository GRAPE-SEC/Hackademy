# Socket / IP / Port / network

<aside>
💡 author : 전재호(agamtt) 2023-09-23

</aside>

우리는 앞서, 인터넷이 이렇게 생겨먹었다고 배웠습니다.

내 컴퓨터에 설치된 프로그램과, 서버에 설치된 프로그램이 인터넷을 통해 통신하는 형태이죠

![Untitled](Untitled%20175.png)

더 자세히 들여다보면, 프로그램은 프로세스가 되어서 실행되고, 프로세스는 소켓을 가지고 있으며, 그 소켓을 거쳐 네트워크 인터페이스를 통해 인터넷과 연결됩니다.

서버 쪽에서도 마찬가지로, 소켓을 가지고 있는 프로세스가 작동하고 있으며, 수천 수만개의 소켓을 생성했다가 없앴다가 하면서 사용자와 인터넷을 통해 연결됩니다. 그래서 서버의 네트워크 인터페이스는 아주 성능이 좋아야합니다. (비싸다는 뜻)

![Untitled](Untitled%20176.png)

# 인터넷 통신

인터넷과 네트워크는 **다른 말**입니다.

정확히 말하면 네트워크가 더 큰 개념입니다.

“전세계가 연결되는 네트워크”가 인터넷입니다.

인터넷에서 컴퓨터가 서로 통신하려면 “주소” 가 필요합니다.

핸드폰번호나 집주소가 바로 “주소”입니다.

핸드폰번호가 있어야 누군가에게 전화를 걸 수 있습니다.

“주소”는 계층적 구조를 띄고 있습니다.

계층적 구조라는게 뭔말이냐면, 커다란 분류가 먼저 나오고, 작은 분류가 나중에 나온다는 말입니다.

왜 만들어놨느냐 하면, 그것이 효율적이기때문입니다.

02-2260-5401 이라는 전화번호는 02 라는 번호가 먼저 나옵니다. 02는 서울의 전화번호라는 뜻이니, 통신사는 이러한 전화번호 요청을 받으면 해당되는 번호를 서울에서만 찾을 것 입니다.

만일 전화번호가 계층적 구조가 아니였다면, 영국에사는 존은 1번이고 한국에사는 철수는 24억7천몇번일테니, 철수를 찾을려면 24억7천번 세야합니다. 매우 비효율적입니다.

마찬가지로 인터넷에서의 주소도 계층적 구조로 되어 있습니다.

인터넷 주소는 다음과 같은 계층으로 통신 대상을 찾아냅니다.

- **어떤 컴퓨터인지** 찾는다.
- **어떤 소켓**을 사용하고 있는지 찾는다.

- “어떤 컴퓨터” 인지는 **아이피 주소**를 통해 알아냅니다.
- “어떤 소켓”을 사용하고 있는지는 **포트번호**를 통해 알아냅니다.

# 아이피 주소 (IP address)

어떤 컴퓨터인지 찾을 때는 우선 IP 주소로 찾습니다.

IP주소는 점으로 분리된 네개의 숫자로 되어있습니다.

각 자리는 0~255 의 숫자입니다.

- 0~999가 아닌 이유는 이진수여서 그렇습니다.
- 00000000~11111111 입니다.

![Untitled](Untitled%20177.png)

현재는 IPv4 (아이피 버전4) 를 사용중입니다.

IPv6로 바꾼대는데 언제 바꿀지는 모르겠네요. 아직은 대다수의 컴퓨터가 IPv4 로 작동합니다.

IPv6 도 별 다를건 없습니다.

아이피 주소는 돈주고 파는 상품입니다.

통신사에 달마다 "인터넷 요금” 이라는 걸 지불해야 사용할 수 있습니다.

<aside>
💡 남의 집 와이파이를 훔쳐쓰거나 메가커피 와이파이를 사용하는건 남의 집 주인이랑 메가커피 주인이 돈을 내고 있는 것 입니다.

</aside>

![Untitled](Untitled%20178.png)

# 포트번호(Port)

IP 로 컴퓨터를 찾고 나면, **포트번호(Port)** 로 소켓을 찾아냅니다.

소켓을 찾아내고 나면, 프로세스끼리 통신을 할 수 있게 됩니다.

![Untitled](Untitled%20179.png)

포트번호는 **0**~**65535 의** 값 입니다. 부호가 없는 16비트 정수이기 때문입니다. (unsigned int)

너무 적은거 아니냐고요? 어차피 더 많아봤자 CPU 가 처리를 못해서 쓸모 없습니다.

<aside>
💡 CPU 가 빠르면 초고속으로 포트를 만들었다가 없앴다가 하면서 작동합니다.

</aside>

보통 IP주소와 Port 번호는 한 쌍입니다. 두개가 다 있어야 프로세스를 찾을 수 있으니까요.

IP와 Port 를 같이 쓸때에는 콜론(:) 으로 구분합니다.

192.168.0.1:8080 이렇게요. 이건

- IP : 192.168.0.1
- Port : 8080

이라는 뜻입니다.

# 라우터와 네트워크

모든 컴퓨터가 각자 IP주소를 가지면 다음과 같은 단점이 있습니다.

- **모든 컴퓨터가 인터넷을 통해서만 통신할 수 있음**. 가까이 있는 컴퓨터는 그냥 인터넷을 거치지 않고 통신하면 빠를텐데…
- 통신하는 것 만으로, **내 IP 주소가 들통남** (IP 추적)
- 세상사람들이 컴퓨터를 너무 많이 사서 IP주소가 다 떨어짐 (**주소 고갈**)
    - IP 주소가 부족해짐 → IP주소가 비싸짐 → 노트북, 아이패드, 스마트폰이 있으면 통신사에 요금을 세배로 내야됨

그래서 **라우터(Router, 공유기)** 라는 장비를 통해 **사설 네트워크**를 만듭니다.

<aside>
💡 와이파이 공유기는 라우터인데 무선 와이파이 기능이 있는 라우터를 말합니다.

</aside>

 

라우터는 **컴퓨터**입니다.

컴퓨터이므로, **IP주소**를 가집니다.

라우터 안의 컴퓨터들은 라우터를 통해서 인터넷과 연결됩니다.

라우터는 공유기라고도 불립니다.

이렇게 생겼습니다.

안테나를 가지고 있는 무선 네트워크 라우터도 있고,

![Untitled](Untitled%20180.png)

![Untitled](Untitled%20181.png)

이렇게 생긴 유선 라우터도 있습니다.

![Untitled](Untitled%20182.png)

이렇게 어떤 대상을 통해 인터넷과 연결될때, 그 대상을 **관문**이라는 의미에서 게이트웨이(**Gateway** 라고 부릅니다.) 게이트웨이는 컴퓨터가 될 수도 있고, 라우터가 될 수도 있고, 다른 어떤 장비가 될 수도 있습니다.

![Untitled](Untitled%20183.png)

보통 라우터가 게이트웨이이지만, 핫스팟(Hotspot) 등의 기능으로 스마트폰을 통해서 인터넷에 연결해본적이 있을 것입니다. 이런 경우, 스마트폰이 게이트웨이 입니다.

![Untitled](Untitled%20184.png)

게이트웨이의 외부 IP주소를 업링크(Uplink) 라고 부릅니다.

게이트웨이 외부의 인터넷에서 게이트 웨이 내부에 있는 기기와 통신할 때, 게이트웨이를 거쳐서 통신합니다.

![Untitled](Untitled%20185.png)

계속