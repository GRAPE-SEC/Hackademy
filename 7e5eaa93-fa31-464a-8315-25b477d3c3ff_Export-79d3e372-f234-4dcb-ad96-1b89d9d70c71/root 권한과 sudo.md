# root 권한과 sudo

<aside>
💡 author : 전재호(agamtt) 2023-11-25

</aside>

<aside>
🔥 **주의 : 리눅스 명령어를 눈으로만 읽어보지 마시오.**
모든 명령어는 직접 입력해보지 않으면 익히기 어렵습니다.
명령어를 계속 사용하면서, 키보드로만 컴퓨터를 통제하는 방법에 익숙해져야 해커가 될 수 있습니다.

</aside>

# whoami

가장 간단한 명령어는 whoami (나는 누구냐?) 입니다.

리눅스에게 나는 누구인지 물어봅니다.

이것은 “현재 로그인한 유저” 가 누구인지 표시하는 명령어입니다.

docker exec 으로 접속한 경우(docker desktop 의 Exec 탭으로 접속했거나, vscode 로 접속한 경우), root 라는 계정으로 접속됩니다.

whoami 를 입력하면 root라고 표시됨을 알 수 있습니다.

```bash
whoami
```

![Untitled](Untitled%20145.png)

이제 컴퓨터를 사용해보겠습니다.

echo 는 메아리라는 뜻으로, 입력한 것을 그대로 화면에 결과를 출력하게하는 명령어입니다.

## echo

아래 명령어를 입력해봅시다.

```bash
echo hello
```

![Untitled](Untitled%20146.png)

그러면 리눅스가 똑같은 말을 앵무새처럼 화면에 출력합니다.

# root

root 는 모든 리눅스에 존재하는 유저로, 관리자 계정을 의미합니다. Windows 에서는 Administrator 와 동일합니다. macOS 에서도 root 라고 부릅니다. (열받게 마이크로소프트 지혼자 다르게 부릅니다.)

리눅스는 여러 계정을 생성해서 여러명이 쓰는데에 특화되어있습니다.

여러 계정이 쓸 때, 갑자기 한사람이 남의 파일을 삭제해버리거나 하면 곤란합니다.

따라서, 리눅스에는 root 라는 관리자 계정이 있어서, root 만 모든 명령어를 제한없이 실행할 수 있고 다른 계정은 명령어 실행이 제한됩니다.

다른 계정이 어떤 명령어를 실행하고 어떤 프로그램을 쓸수있고 어떤 파일을 삭제할 수 있는지는 root 가 규칙을 정합니다.

# passwd

일단 처음 리눅스를 켜면, root 유저는 비밀번호가 설정되어있지 않습니다.

아래 명령어를 입력하면, root 계정의 패스워드를 설정할 수 있습니다.

```bash
passwd root
또는
passwd
```

![Untitled](Untitled%20147.png)

<aside>
🔥 **패스워드가 입력이 안되는데요?**
패스워드가 입력되지 않는 것처럼 보이지만, 실제로는 입력되고 있는 것 입니다.
이는 리눅스의 보안기능으로, 뒤에서 누가 비밀번호가 몇글자인지 엿보는 것을 막기 위해서 아얘 표시를 안합니다.

</aside>

passwd 명령어는 한번 더 입력하면 다시 새로운 비밀번호를 설정합니다.

## 일반유저

내가 컴퓨터 주인이더라도, 리눅스에서는 root 계정으로 컴퓨터를 사용하면 안됩니다.

명령어 중 어떤 명령어는, 잘못 입력하면 컴퓨터에 있는 모든 파일을 삭제하는 것 처럼 돌이킬 수 없는 위험한 명령어들이 있습니다.

또한 나 말고 다른사람이 저장해놓은 파일을 덮어씌우거나 삭제하면 큰일입니다.

따라서 반드시 일반유저를 생성해서 사용하고, 꼭 필요할 때 root 로 로그인해서 쓴 후, 다시 일반유저로 로그인해야합니다.

<aside>
🔥 **root , 해커가 쓰면 큰일남**

대부분의 경우, 해킹의 목적은 해커가 root 계정으로 로그인할 수 있게 만드는 것 입니다.

해커는, root 계정의 비밀번호를 훔치거나, 각종 해킹 방법을 써서 root 를 뺏기 위해 노력합니다. 반대로 컴퓨터 주인은 root 계정을 뺏기지 않도록 해야합니다.

</aside>

# adduser

adduser 는 유저를 새로 추가하는 명령어입니다.

**이 명령어는 root 만 수행할 수 있습니다.**

새로운 유저를 만들어봅시다.

*참고로, {{ }} 로 둘러쌓인 것이 명령어 안내란에 있으면, 실제 값을 넣어서 변경하라는 뜻입니다.

```bash
adduser {{user name}}
```

저는 슈퍼해커이므로, superhacker 라는 계정을 만들어보겠습니다. (참고로 유저네임은 영문 알파벳만 쓸 수 있습니다.)

```bash
adduser superhacker
```

![Untitled](Untitled%20148.png)

패스워드를 입력하라고 하면, 패스워드를 입력하고 엔터를 칩니다.

<aside>
🔥 **패스워드가 입력이 안되는데요?**
패스워드가 입력되지 않는 것처럼 보이지만, 실제로는 입력되고 있는 것 입니다.
이는 리눅스의 보안기능으로, 뒤에서 누가 비밀번호가 몇글자인지 엿보는 것을 막기 위해서 아예 표시를 안합니다.
New password 와 Retype new password 에서 입력한 패스워드가 동일해야 유저를 생성할 수 있습니다.

</aside>

Full Name 이나 Room Number 같은건 안입력해도 됩니다. 엔터를 치면 생략됩니다.

마지막에 Is the information correct? 라고 물어보면, 그냥 엔터를 치거나 y를 입력하고 엔터를 칩니다.

이제 일반유저가 생성되었습니다!

### home 폴더

유저를 생성하면 유저의 home 폴더가 생성됩니다. 이것을 Windows 나 Mac에서 일종의 바탕화면의 개념입니다.

root 계정이 아닌 일반유저는 각자의 home 폴더에만 들어갈 수 있습니다.

현재 로그인한 계정의 홈폴더는 직접 입력해서 들어가거나,

```bash
cd /home/superhacker
```

또는 그냥 물결을 쓰면 자동으로 리눅스가 현재 로그인한 유저의 홈폴더를 입력해줍니다.

```bash
cd ~
```

# su

su 는 switch user 의 약자로, 다른 유저로 변경하는 명령어입니다.

일종의 로그아웃, 로그인의 개념입니다.

root 에서 superhacker 로, superhacker 에서 root 로 전환할 수 있습니다.

root 명령어가 꼭 필요할 때만 root 로 전환하고, 평소에는 superhacker 나 자기 계정으로 리눅스를 사용해야합니다.

아래와 같이 입력하면, 입력한 유저로 변경됩니다.

```bash
su {{username}}
```

root 로 로그인된 상태에서 whoami 를 입력하면 root 라고 나옵니다.

그리고 su superhacker 로 superhacker 로 유저를 전환합니다.

그리고 whoami 를 입력하면 superhacker 라고 나옵니다.

![Untitled](Untitled%20149.png)

이제 root로 다시 바꿔봅시다.

```bash
su root
```

맨 처음에, passwd root 로 root 계정의 패스워드를 설정했던걸 기억해보세요.

그 비밀번호를 입력하면 root 로 로그인할 수 있습니다.

패스워드가 틀리는 경우, Authentication failure 라고 나옵니다.

![Untitled](Untitled%20150.png)

패스워드가 맞는 경우, root 로 전환됩니다. whoami 를 입력해보니 root 라고 나오네요.

![Untitled](Untitled%20151.png)

### 기존유저로 돌아가기 : exit

리눅스에서는 어떤유저에서 다른 유저로 su 한 경우, 다시 기존 유저로 빠져나올 수 있습니다.

안방에 화장실이 있으면, 화장실에 있다가 나오면 안방인 것처럼 작동합니다.

exit 명령어를 사용하면 됩니다.

```bash
exit
```

root 인 상태에서 superhacker 로 su 하고, exit 하면 다시 root 로 돌아옵니다.

아래 명령어를 순서대로 입력해보면 확인할 수 있습니다.

![Untitled](Untitled%20152.png)

### 현재 컴퓨터에 있는 모든 계정 확인 : cat /etc/passwd

이제 adduser 로 유저를 계속 추가해서 사용할 수 있습니다.

어떤 유저가 추가되어있는지 어떻게 확인할까요?

리눅스에서, cat 명령어를 이용하면 텍스트파일을 읽을 수 있습니다.

```bash
cat {{텍스트파일이름}}
```

adduser 로 추가된 유저이름목록은 /etc/passwd 라는 파일에 적혀있습니다.

따라서 해당 파일을 읽어서 유저이름목록을 확인합니다.

```bash
cat /etc/passwd
```

daemon, bin, sys, sync … 이상한 문자들이 출력됩니다.

이것은 리눅스가 정상적으로 동작하기 위한 유저들로, 사람이 사용하는 것이 아니라, 리눅스가 작동하기 위해서 사용합니다. 예를 들어, mail 이라는 유저는 리눅스로 메일을 보낼때 리눅스가 사용하는 계정입니다. 이런 계정을 **리눅스 시스템 계정**이라고 부릅니다.

그리고 맨 아래에 보면 아까 adduser 로 생성한 superhacker 계정이 보입니다. 

사람이 사용하는 계정에는 /bin/bash 라는 것이 적혀 있습니다. 그것으로 사람이 사용하는 계정과 리눅스 시스템 계정을 구분할 수 있습니다.

![Untitled](Untitled%20153.png)

### userdel

생성한 유저를 삭제하려면 userdel 명령어를 사용합니다. user delete 의 약자입니다.

```bash
userdel -rf {{username}}
```

아까 생성한 superhacker 계정을 삭제해보겠습니다.

### sudo

아까, 중요한 작업을 할때에는 root 유저로 수행해야하고, 일반 작업을 할때에는 adduser 로 생성한 일반 유저로 컴퓨터를 사용해야한다고 했습니다.

즉, 만약 어떤 명령어를 root 로 실행시키고, 바로 일반유저로 su 해야합니다.

```bash
su root
(패스워드 입력)
(root 로 전환됨)
(root 로 실행할 명령어 입력)
su superhacker
```

이것은 일단 su 를 두번 입력해야해서 불편합니다. 

그리고, 여러명의 유저가 동시에 리눅스를 사용한다고 가정해봅시다.

만일 어떤 유저가 root 계정을 사용해야한다면 root 계정을 가진 사람이 그 유저에게 root 비밀번호를 알려줘야합니다.

만약 특정 기간동안만 root 계정을 사용하게 하고, 그 이후에는 못 사용하게 하려면 root 비밀번호를 변경하는 수 밖에 없습니다.

근데 그러면 또 다른 유저가 root 계정을 잘 사용하다가 비밀번호가 바뀌어서 사용할 수 없게됩니다.

즉, “root 계정을 사용할 수 있는 사람” 을 관리할 수 없습니다.

이것을 권한 관리라고 부릅니다.

리눅스는 권한 관리를 위해서 sudo 라는 개념을 도입했습니다.

sudo 는 super user do (최고 권한으로 실행한다) 의 약자입니다.

sudo 를 어떤 명령어 앞에 붙이면, 자동으로 root로 su 하여 해당 명령어만 실행시킨다음 다시 원래 유저로 su 합니다.

```bash
sudo {{command}}
```

즉, 이것은 아래 명령어와 같습니다.

```bash
su root
{{command}}
su {{원래 유저}}
```

예를 들어, 아래 명령어는 echo hello 라는, hello 를 화면에 출력하는 명령어를 root 가 잠시 된 후, 실행하고 다시 원래 유저로 돌아옵니다. echo hello 는 일반 유저도 사용할 수 있는 명령어라서 동일하게 출력되지만, root 만 실행할 수 있는 명령어는 sudo 를 앞에 붙여야만 사용할 수 있습니다.

```bash
sudo echo hello
```

그리고 sudo 그룹에 속한 유저는 속한 동안만, root 계정의 비밀번호가 아니라, 자신의 비밀번호로 root 계정을 잠시 사용할 수 있습니다.

root 가 그 유저를 sudo 그룹에서 제거하면, 더이상 root 를 사용할 수 없게 되니, 관리가 용이해집니다. 리눅스 개발자들이 만든 이런 방식을 **권한 관리**라고 부르는데, 지금도 거의 모든 컴퓨터가 이런식으로 유저를 관리한다는 것을 알 수 있습니다.

<aside>
🔥 경우에 따라, sudo 명령어가 안 설치되어있을수도 있습니다. 그럴때는 아래 명령어를 입력해서 sudo 를 설치합니다.
(root 로 로그인 한 상태에서, )
apt update
apt install sudo

</aside>

sudo 는 sudo 그룹에 속한 유저계정만 사용할 수 있습니다.

sudo 그룹에 속했다는 것은, 해당 컴퓨터의 root 를 사용할 수 있는 사람에 속한다는 뜻입니다.

root 유저만 sudo 그룹에 어떤 유저를 새로 추가할 수 있습니다.

이렇게 sudo 그룹에 속해서, 자신의 패스워드로 root 를 사용할 수 있는 유저를 **sudoers** (sudo를 하는 사람) 이라고 부릅니다.

### sudo 그룹에 user 를 추가하기 : usermod

usermod 명령어를 이용하여 sudo 그룹에 어떤 유저를 새로 추가할 수 있습니다.

usermod -aG 는 user modify -append Group 의 약자로, 어떤 유저를 어떤 그룹에 속하게 설정합니다.

```bash
usermod -aG {{group}} {{username}}
```

어떤 유저를 sudo 에 속하게 하려면 이렇게 입력합니다. 단, 이 명령을 일반유저가 수행할 수 있도록 하면 자기자신을 sudo 에 포함해서 root 를 쓸수있게 되니, 오직 root 만 sudo 그룹에 새로 유저를 추가할 수 있습니다.

superhacker 계정을 sudo 그룹에 추가하는 명령어는 아래와 같습니다.

```bash
usermod -aG sudo superhacker
```

이렇게 sudo 그룹에 속해서, root 나 다름없는 권한을 가지게 됩니다.

만일 sudo 그룹에 속하지 않은 사람이 sudo 를 사용하려고 한다면 이렇게 출력됩니다.

“superhacker 라는 계정을 sudoers 가 아닙니다. 이 시도는 기록됩니다.”

(기록을 하는 이유는 해킹시도가 있었을때 root 가 알수있도록 하는 기능입니다.)

![Untitled](Untitled%20154.png)

이제 root 로 로그인된 상태에서 usermod -aG sudo superhacker 를 사용하여 sudoers 에 추가하면, sudo echo hello 를 superhacker 의 비밀번호로 사용할 수 있게 됩니다.

![Untitled](Untitled%20155.png)

### sudo 그룹에서 삭제하기 : deluser

이제 특정유저가 sudo를 더이상 못사용하게 하기위해 sudo 를 뺏는 방법입니다.

이 명령어는 root 만 수행할 수 있습니다.

따라서 sudo 그룹에 속한 다른 사용자가 sudo 를 이용하여 실행하거나, root 가 실행해야합니다.

```bash
sudo deluser {{username}} sudo
root 가 실행하는 경우,
deluser {{username}} sudo
```

아래와 같이 명령어를 수행하고 나면 더이상 sudo 를 쓸수 없게 되었습니다.

![Untitled](Untitled%20156.png)

sudo 는 프로그램을 설치하거나, 설정파일을 수정할 때 필요합니다.

리눅스는 여러 사용자가 함께 사용하는데에 특화되어 있는 운영체제입니다.

sudo 에 속한 사람이나, root 계정으로 프로그램 등을 설치해놓고 설정한다음, adduser 로 사용자 계정을 만들어주면 사용자들이 접속해서 프로그램을 사용해서 계산을 하거나, 게임을 하거나, 인터넷을 하는 등 개인 목적으로 쓸 수 있습니다.

중요한 동작은 sudo 를 사용할 수 없으니, 컴퓨터가 고장나지 않게 여러명이 사용할 수 있습니다.

또한, 관리자를 여러명으로 지정한 후, 그 관리자를 누구로 지정할지, 해제할지 편리하게 설정할 수 있습니다.

## 해킹과 root

다시말하면 sudo 는 악성프로그램을 설치할 수 있게하고, 해커가 컴퓨터로 들어올 수 있도록 설정파일을 수정하는데에도 쓰일 수 있습니다.

따라서 해커는 sudo , 즉 root 를 탈취하기 위해 다양한 방법을 시도합니다.

그런 방법들에 대해서 차차 배우겠습니다.

계속