# 7-3_Session_login_Hacking : Session Hijaking

<aside>
💡 author : 전재호(agamtt) 2024-01-25

</aside>

# 정리

세션을 사용하면, 보안이 매우 향상 됩니다. 따라서 현대 웹페이지는 거의 모두 세션을 사용합니다.

- 접속하는 모든 사람은 세션을 부여받습니다. 인터넷에서, 세션은 나 그 자체 입니다.
- 세션쿠키는 세션파일을 찾는데에만 사용됩니다.
    - 조작해도 소용이 없습니다.
- 인증정보는 서버에 있는 세션파일에 저장되므로 조작이 불가능합니다.

그러나, 다음점을 유의해야합니다.

**“인터넷에서 세션은 나 그 자체입니다.”**

즉, 내가 아닌 다른 사람이 나의 세션값을 알게 되면, 그사람은 인터넷에서 **나인 행세**를 할 수 있습니다.

세션을 훔치는 해킹을 세션 하이재킹(Session Hijacking) 이라고 부릅니다.

세션아이디는 세션쿠키에 있습니다. 즉, 브라우저에 저장되어있습니다.

어떻게든 이 세션쿠키에 접근해서, 세션아이디를 훔치면, 해당 계정으로 로그인한 것이나 마찬가지 입니다.

# 고양이 홈페이지 세션 탈취

한번 실제로 확인해봅시다.

grape 유저로 로그인 한 후, PHPSESSID 를 보면 세션ID가 저장되어있습니다.

이것을 복사한 후,

![Untitled](Untitled%20532.png)

다른 브라우저의 PHPSSID 에 바꿔치기로 복붙하면 page-grape.php 에 접속할 수 있게 됩니다.

![Untitled](Untitled%20533.png)

![Untitled](Untitled%20534.png)

# 쿠팡(진짜임) 세션 탈취

친구가 쿠팡에 로그인했을때, 친구 브라우저에 저장된 쿠팡의 세션을 훔치면 친구 아이디로 로그인할 수 있습니다.

<aside>
⚠️ **주의 : 문제생기면 니책임**
실제 남한테 실험하라고 한적 없습니다.
본인 계정으로 시험하거나, 이 실습은 아예 안 따라해봐도 됩니다.

</aside>

쿠팡(2024-01-15 기준) 의 웹사이트는 3개의 세션을 사용합니다.

- CSID
- CUPT
- CPUSR_RL

친구가 로그인해있고, 어떤 방법을 통해 이 세개의 값을 알아냈다고 가정해봅시다.

로그인 비밀번호는 당연히 알 수가 없지만, 세션은 브라우저에 저장되어있으니, 다양한 방법으로 알아 낼 수 있습니다.

가장 기본적인 방법은 그동안 배웠던대로 브라우저의 개발자 콘솔을 이용하는 방법입니다.

로그인되어있는 브라우저에서, 이 값을 확인합니다.

![Untitled](Untitled%20535.png)

이제 공격자(해커)의 브라우저에서 이 값을 똑같이 넣습니다.

재현해보기 위해 게스트 브라우저를 열거나 다른 브라우저를 열면 됩니다.

현재 로그인이 안되어있는 상태입니다.

![Untitled](Untitled%20536.png)

잘 붙여넣고 나면,

![Untitled](Untitled%20537.png)

다른 브라우저에서 해당 계정으로 로그인됩니다.

이런…

![Untitled](Untitled%20538.png)

계정을 탈취했으므로, 주문목록같은 민감한 정보를 유출할 수 있습니다.

![Untitled](Untitled%20539.png)

이런. 최근에 블루투스 헤드폰이랑 영양제를 쿠팡에서 샀군요

실제 상황이였으면 해킹 사고로 이어지는 무서운 상황입니다.

![Untitled](Untitled%20540.png)

아무튼,

현대 인터넷에서, 세션아이디를 훔쳐서 자기 브라우저에 넣으면 그 사람 행세를 할 수 있습니다.

세션아이디를 훔치기 위해 해커들은 다양한 방법을 고안해왔습니다. 몇가지를 소개해보겠습니다.

# Shoulder Surfing (어깨 너머 공격)

멋지게 표현했는데 걍 훔쳐보는겁니다.

누가 로그인하고 화장실에 가면 개발자 콘솔 열어서 재빨리 휴대폰 카메라로 캡쳐합니다.

<aside>
⚠️ **주의 : 문제생기면 니책임**
다시한번 말하지만, 실제 남한테 실험하라고 한적 없습니다!!!

</aside>

# Phishing (피싱)

다른 방법은 사용자를 속이는 것 입니다.

어떻게 속이느냐가 관건인데, 보통 일반인들은 컴퓨터에 대해 잘 모른다는 점을 이용합니다.

개발자콘솔을 열어서, 쿠키값을 캡쳐해달라고 부탁하거나, 해당 값을 알려달라고 했을때, 이게 뭔지 모르니 알려줄 수도 있습니다. 사실은 아이디 비번을 알려주는 것보다 치명적입니다.

최근의 웹사이트는 아이디 비번이 유출되더라도, 새로운 환경 (새로운 기기, 브라우저, IP주소)에서는 로그인할 수 없고, 

그러나 대부분의 경우 세션에 대해서는 방어하지 않습니다. 세션 탈취를 가정하지 않기 때문이죠. 

# XSS, CSRF (크로스 사이트 스크립팅)

어떤 명령어는, 쿠키에 직접 접근하고 쿠키값을 읽을 수 있습니다.

예를 들어, document.cookie 라는 자바스크립트 명령어는 쿠키값을 읽어서 반환합니다.

![Untitled](Untitled%20541.png)

이처럼 쿠키를 읽어서, 이를 외부로 전송하는 코드를 만들고, 클라이언트-사이드에서 실행시킬 수만 있다면 쿠키를 전부 탈취할 수 있습니다.

이러한 종류의 해킹 기법을 다른 사이트(Cross Site)로 코드를 실행한다(Scripting) 고 해서 크로스사이트스크립팅(XSS) 라고 부릅니다.

이것은 복잡한 주제이고, 다양한 보안정책을 우회해야하니, 여기선 실습으로 다루지 않고 사례를 소개하겠습니다.

![Untitled](Untitled%20542.png)

![Untitled](Untitled%20543.png)

### 틀딱 주의

<aside>
🥷🏻 과거에 존재했던 싸이월드 방문자 추적기는 XSS 를 원리로 작동합니다.

</aside>

![Untitled](Untitled%20544.png)

계속