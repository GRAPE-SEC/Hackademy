# 악성코드, 컴퓨터 바이러스

# 악성코드

악성코드(멀웨어,Malware) 는 나쁜 행위를 하는 컴퓨터 프로그램을 말합니다.

- 앞서, 우리는 온갖 시스템에서 발견될 수 있는 대표적인 취약점들의 예시와 그 취약점을 찾는 방법들을 배웠습니다.
- 그러나 취약점이 없을 수도 있습니다. 못찾았거나요. 사실 해커 입장에서는 둘다 똑같습니다. 해킹 못하는거죠

또한 있었던 취약점이, 보안 패치로 없어질 수도 있습니다. 사용자 입장에서는 안전해져서 좋은건데, 해커 입장에서는 이제 그 취약점으로는 해킹할 수 없는게 되는거죠 아쉬운거지…

사실 근데 악성 행위를 하는데에 반드시 취약점이 필요한 것은 아닙니다.

**임의코드실행(ACE, RCE) 취약점을 찾을 필요가 없습니다**

**그냥 사용자가 내 코드를 실행해주면 임의코드실행입니다!**

<aside>
😀

그냥 사람이 악성코드를 실행해주면 된다

</aside>

![image.png](image%20202.png)

# 사회공학(Social Engineering)

인간을 속이는 방법을 **사회공학적 해킹**이라고 부릅니다. 왜인지는 모르겠는데 다들 그렇게 부름

이메일을 사칭하거나,

![image.png](image%20203.png)

![image.png](image%20204.png)

공짜를 좋아하는 인간의 심리를 이용합니다.

![image.png](image%20205.png)

![image.png](image%20206.png)

![image.png](image%20207.png)

우리는 리버싱을 배웠으므로, 정상 실행파일 안에 코드를 삽입해서 내가 원하는 동작을 하도록 만드는 것이 가능함을 알고 있습니다

따라서 정상 프로그램의 바이너리 안에 악성코드를 넣거나, 악성코드를 실행하는 코드를 넣으면 되는 일인거죠

해킹이 일어나는 순서는 보통 아래와 같습니다

- 한글 유료 버전을 구매한다
- 공짜로 쓸 수 있는 버전을 만든다
- 그러는 김에 트로이목마를 안에 심는다
- 백신 프로그램에 탐지되지 않도록 이것 저것 한다.
    - 이건 해커들 마다 노하우가 다른데, 보통 코드난독화를 이용합니다
- 백신 프로그램에 검사를 돌려보면서 안걸리나 확인한다
- 백신 프로그램에 안전해지면, 그 화면을 캡쳐하고 블로그에 올려놓고 기다린다
- 누군가 다운로드 받아서 실행하면 그 컴퓨터를 해킹한다.

![image.png](image%20208.png)

안드로이드는 사용자가 원하는 앱을 apk 파일을 통해 설치할 수 있기 때문에, 악성앱을 설치하는 경우 해킹이 발생할 수 있습니다

![image.png](image%20209.png)

![image.png](image%20210.png)

# 트로이목마

**트로이목마(Trojan)** 는 정상 프로그램 처럼 보이도록 위장하고 내부에서는 악성행위를 하는 프로그램을 말합니다

우리는 트로이목마 중, 원격으로 해커가 통신할 수 있도록 문을 안에서 따주는 트로이목마인 **원격 접속 트로이목마**(Remote Access Trojan, RAT) 을 만들어보겠습니다.

다만 우리는 피해자 컴퓨터가 없으니 우리가 해커와 피해자를 둘다 역할놀이를 해보겠습니다.

# 백신

이러한 “**사용자가 아무 프로그램이나 실행할 수 있을 때, 악성 프로그램을 실행하여서 해킹이 발생**” 이라는 문제를 해결하기 위한 방법이 백신 프로그램입니다.

일반적으로 백신프로그램은 앞서 배운 메모리해킹이나 웹 클라이언트 취약점을 방어하는 것이 아니고, 주로 실행파일(exe, elf 등) 을 분석해서 악성코드인지 판별하는 프로그램입니다. 

물론 당연히 백신 프로그램도 별도의 실행파일로 실행되는 바이너리입니다. 설치를 해야 쓸 수 있습니다

<aside>
💡

Windows Defender 는 Windows 를 설치할때 기본으로 설치되는 백신 프로그램입니다.
그러나 자동으로 설치되는 것이지 운영체제나 커널의 일부가 아닙니다

</aside>

![image.png](image%20211.png)

백신 회사 홈페이지를 들어가보면 수많은 악성코드들이 “명예의 전당” 에 올라있는 것을 확인할 수 있습니다.

[https://www.ahnlab.com/ko/contents/asec/info](https://www.ahnlab.com/ko/contents/asec/info)

![image.png](image%20212.png)

![image.png](image%20213.png)

# 방어 아이디어 : 걍 금지한다

사실 “**사용자가 아무 프로그램이나 실행할 수 있을 때, 악성 프로그램을 실행하여서 해킹이 발생**” 의 근본적인 이유는 **사용자가 아무 프로그램이나 다운받아서 실행할 수 있기 때문**입니다.

그렇다면, **프로그램을 회사가 다 만들고, 설치할 수 있는 프로그램을 정해주고, 나머지는 아예 못설치하게 하면 해결되는거 아닌가?**

라는 생각을 할 수 있습니다. 

군대식으로, 나쁜짓을 할수도있으니까 아예 못하게 만들자는건데

미친 생각이죠 회사가 전세계의 모든 프로그램을 만들거나 점검하려면 몹시 인력과 돈이 많이 들테니까요

- 돈이 많아야 됨 (앱이 악성앱인지 점검하는데 드는 노동력과 인건비)
    - 그걸 이제 업데이트 마다 매번 해야됨 모든 프로그램에 대해
- 사용자가 불편해짐 → 그래도 팔려야 됨
- 개발자도 불편해짐 → 그래도 개발해줘야됨

따라서 몹시 어렵습니다. 그래서 다들 안하는거죠

근데 이제 그걸 모두 성공시킨 미친 회사가 등장했습니다

# Apple Appstore

<aside>
😀

애플 iphone 과 ipad 에는 아무 프로그램이나 설치할 수 없습니다. 애플 보안팀이 승인한 앱만 “앱스토어” 에 게시되고, 앱스토어에서 다운로드 받은 앱만 사용할 수 있습니다.

</aside>

![image.png](image%20214.png)

[대칭키, 비대칭키 암호화, 컴퓨터에서 말하는 “서명”](%E1%84%83%E1%85%A2%E1%84%8E%E1%85%B5%E1%86%BC%E1%84%8F%E1%85%B5,%20%E1%84%87%E1%85%B5%E1%84%83%E1%85%A2%E1%84%8E%E1%85%B5%E1%86%BC%E1%84%8F%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%B7%E1%84%92%E1%85%A9%E1%84%92%E1%85%AA,%20%E1%84%8F%E1%85%A5%E1%86%B7%E1%84%91%E1%85%B2%E1%84%90%E1%85%A5%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%86%E1%85%A1%E1%86%AF%E1%84%92%E1%85%A1%E1%84%82%E1%85%B3%E1%86%AB%20%E2%80%9C%206d414e12a69f461e9fef2860c22d45cf.md)

그러기 위해서 애플 앱스토어는 코드 서명 기술을 이용하는데, 몰라도 됩니다.

![image.png](image%20215.png)

Apple iphone 에 아무 **앱이나 설치하려면,** 아이폰을 탈옥(jailbreak) 시켜야합니다.

아이폰의 root 권한을 얻으면 코드서명이 없는 앱을 설치할 수 있게 됩니다 ****

# 완벽한 방법인가?

그랬으면 다들 그렇게 했겠죠

근데 이러면 여러가지 부작용이 생기는데, 

일단 다른 앱도 못깔기 때문에 여러가지 문제가 발생합니다

![image.png](image%20216.png)

그리고 반독점법 위반이고, 모든 앱을 검토하기 위한 돈을 수수료로 충당하기 때문에 개발자와 업체가 반발을 합니다

![image.png](image%20217.png)

![image.png](image%20218.png)

<aside>
💡

그리고 사실 완전히 악성앱이 없지는 않습니다.

애플 직원들의 실수로 앱스토어에 승인되어 업로드 되는 것이죠

</aside>

![image.png](image%20219.png)

![image.png](image%20220.png)

## 그럼에도 불구하고

하지만 애플 아이폰을 쓰면 매우 안전합니다

이유는

- 아이폰 사용자들은 돈을 내고 쓰는 것에 익숙하다. 따라서 유료앱을 사지 공짜를 탐하지 않는다
- 애플은 해킹을 막기위해 보안전문가와 해커를 대거 채용한다
    
    ![image.png](image%20221.png)
    
- 애플은 하위호환을 안해준다
    - 다른 회사의 제품들(Samsung, Microsoft, Oracle …) 은 옛날 기기를 쓰는 사용자들도 지원해주기 위하여 보안이 취약하더라도 지원해주려는 노력을 한다
    - 애플은 **그냥 새거를 사라고 하고** 지원을 끊는다. 따라서 해킹막기 난이도가 낮다.
    
    ![image.png](image%20222.png)
    

그러나 수수료도 많이 뗄수있고, 지들이 싫은 앱은 거부할수도있고 여러모로 좋기 때문에 여러 기업에서 따라할려고 하는 중이다

![image.png](image%20223.png)

![image.png](image%20224.png)

화웨이는뭐야 낄끼해제발

![image.png](image%20225.png)

아 그리고 한국에 있는 어떤

 작은회사는 이걸 할려다가 실패했다

![image.png](image%20226.png)

끝!